# Trends Numbers Alignment Fix

- Number: 3
- Created: 2026-02-19T14:42:06.860017
- File: `3.md`

## Details

Issue
- Trends tab still showed wrong numbers compared with the selected Reports period and other screens.

Root causes
1) Trends date range was not explicitly synced to Reports selected period.
2) Local filtering in CustomerAnalyticsViewModel could exclude entries on the selected end date when time-of-day was after 00:00.
3) Trends UI displayed rounded/decimal hour labels, which made values look wrong compared to minute-accurate views.

Changes made
1) Sync Reports selected range into Trends VM
- File: lib/screens/reports_screen.dart
- Added in provider update:
  - final range = _currentRange();
  - model.setDateRange(range.start, range.end);

2) Fix inclusive day filtering in VM
- File: lib/viewmodels/customer_analytics_viewmodel.dart
- Imported reporting TimeRange.
- setDateRange now normalizes to date-only and no-ops if unchanged.
- _getFilteredEntries now uses TimeRange.custom(start, end) when both bounds exist.
- Date-only comparisons used for partial-bound cases.

3) Remove rounded/decimal Trends labels in key cards
- File: lib/screens/reports/trends_tab.dart
- Imported shared formatter: reporting/time_format.dart.
- Added helper _formatHours(...) that converts hours->minutes and formats via formatMinutes.
- Updated monthly/daily visible numbers to display Hh Mm (signed where needed).
- Increased monthly difference column width to fit Hh Mm values.

Verification
- dart analyze on changed files: no issues.
- flutter test test/reporting/tracked_time_calculator_test.dart: passed.

Files changed in this task
- lib/screens/reports_screen.dart
- lib/viewmodels/customer_analytics_viewmodel.dart
- lib/screens/reports/trends_tab.dart
