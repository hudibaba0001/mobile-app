# Trends monthly context restore (show previous month in MTD)

- Number: 8
- Created: 2026-02-19T15:20:25.099036
- File: `8.md`

## Details

Fixed Trends issue where only February was shown and previous month context disappeared.

Root cause
- Monthly breakdown used strictly selected date range entries and month window.
- For `thisMonth` (e.g., Feb 1..today), month list only contained February, so January row disappeared.

Fix implemented
- In `CustomerAnalyticsViewModel.monthlyBreakdown`, monthly comparison now uses a dedicated comparison range.
- For single-month month-to-date selections (start day = 1, end day < month end), monthly comparison includes previous month context.
- Daily/weekly trends remain tied to selected range; only monthly comparison gets previous-month context.
- Segment filtering (All/Work/Travel) and travelEnabled behavior remain respected for monthly comparison range.

Theme/layout note
- No new hardcoded paddings were introduced. Existing Trends paddings continue to use AppSpacing tokens.

Files changed
- lib/viewmodels/customer_analytics_viewmodel.dart
- test/viewmodels/customer_analytics_viewmodel_test.dart

Tests
- Added regression test: monthly breakdown includes previous month context for single-month range while daily/weekly stay in selected range.
- Existing trends tests still pass.

Verification run
- dart analyze lib/viewmodels/customer_analytics_viewmodel.dart lib/screens/reports/trends_tab.dart test/viewmodels/customer_analytics_viewmodel_test.dart
- flutter test test/viewmodels/customer_analytics_viewmodel_test.dart
